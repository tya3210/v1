<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>防災情報マップ - 完成版</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* 基本スタイル */
        body { margin: 0; padding: 20px; font-family: Arial, sans-serif; }
        #map { height: 500px; margin-top: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.2); }
        
        /* コントロールパネル */
        .control-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        
        /* モーダル関連 */
        .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.2);
            z-index: 1001;
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        /* 災害情報パネル */
        .disaster-alert {
            background: #ffebee;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 5px solid #ff5252;
        }
    </style>
    
    <!-- 必要なライブラリ -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />
</head>
<body>
    <!-- 言語選択 -->
    <div class="language-selector">
        <select id="languageSelect">
            <option value="ja">日本語</option>
            <option value="en">English</option>
        </select>
    </div>

    <!-- コントロールパネル -->
    <div class="control-panel">
        <button id="btnShelters">避難所表示</button>
        <button id="btnChecklist">防災チェックリスト</button>
        <button id="btnEmergency">緊急連絡先</button>
        <button id="btnSimulate">洪水シミュレーション</button>
    </div>

    <!-- 災害情報表示エリア -->
    <div id="disasterInfo"></div>

    <!-- マップ表示エリア -->
    <div id="map"></div>

    <!-- モーダル：防災チェックリスト -->
    <div id="checklistModal" class="modal">
        <h3 id="checklistTitle"></h3>
        <div id="checklistItems"></div>
        <button id="closeChecklist"></button>
    </div>

    <!-- モーダル：緊急連絡先 -->
    <div id="emergencyModal" class="modal">
        <h3 id="emergencyTitle"></h3>
        <ul id="emergencyContacts"></ul>
        <button id="closeEmergency"></button>
    </div>

    <!-- スクリプト -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script>
        // 多言語対応テキスト
        const texts = {
            'ja': {
                shelters: '避難所',
                checklistTitle: '防災チェックリスト',
                emergencyTitle: '緊急連絡先',
                contacts: [
                    {name: '消防署', number: '119'},
                    {name: '警察', number: '110'},
                    {name: '災害用伝言板', number: '171'}
                ],
                checklistItems: [
                    '非常用飲料水（1人3リットル）',
                    '3日分の非常食',
                    '懐中電灯',
                    'ラジオ',
                    '救急セット'
                ]
            },
            'en': {
                shelters: 'Shelters',
                checklistTitle: 'Emergency Checklist',
                emergencyTitle: 'Emergency Contacts',
                contacts: [
                    {name: 'Fire Department', number: '119'},
                    {name: 'Police', number: '110'},
                    {name: 'Disaster Message Board', number: '171'}
                ],
                checklistItems: [
                    'Drinking water (3L per person)',
                    '3-day emergency food',
                    'Flashlight',
                    'Radio',
                    'First aid kit'
                ]
            }
        };

        // マップ初期化
        const map = L.map('map').setView([35.6815, 139.7671], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        // 避難所データ（サンプル）
        const shelters = [
            {
                name: '第一避難所',
                location: [35.682, 139.768],
                capacity: 500,
                facilities: ['水', '食料', '毛布']
            },
            {
                name: '第二避難所',
                location: [35.678, 139.762],
                capacity: 300,
                facilities: ['水', '簡易ベッド']
            }
        ];

        // 避難所マーカー表示
        function showShelters() {
            shelters.forEach(shelter => {
                const marker = L.marker(shelter.location)
                    .bindPopup(`
                        <b>${shelter.name}</b><br>
                        収容人数: ${shelter.capacity}<br>
                        設備: ${shelter.facilities.join(', ')}
                    `).addTo(map);
            });
        }

        // チェックリスト表示
        function showChecklist() {
            const modal = document.getElementById('checklistModal');
            const items = texts[currentLang].checklistItems.map(item => `
                <label>
                    <input type="checkbox"> ${item}
                </label><br>
            `).join('');
            document.getElementById('checklistItems').innerHTML = items;
            modal.style.display = 'block';
        }

        // 緊急連絡先表示
        function showEmergencyContacts() {
            const modal = document.getElementById('emergencyModal');
            const contacts = texts[currentLang].contacts.map(contact => `
                <li>${contact.name}: ${contact.number}</li>
            `).join('');
            document.getElementById('emergencyContacts').innerHTML = contacts;
            modal.style.display = 'block';
        }

        // 洪水シミュレーション
        function simulateFlood() {
            const floodArea = L.polygon([
                [35.680, 139.765],
                [35.678, 139.770],
                [35.675, 139.768]
            ], {color: 'blue', fillOpacity: 0.3}).addTo(map)
            .bindPopup('浸水想定区域');
        }

        // イベントリスナー設定
        document.getElementById('btnShelters').addEventListener('click', showShelters);
        document.getElementById('btnChecklist').addEventListener('click', showChecklist);
        document.getElementById('btnEmergency').addEventListener('click', showEmergencyContacts);
        document.getElementById('btnSimulate').addEventListener('click', simulateFlood);

        // モーダル閉じる処理
        document.querySelectorAll('.modal button').forEach(button => {
            button.addEventListener('click', () => {
                button.parentElement.style.display = 'none';
            });
        });

        // リアルタイム災害情報取得
        async function fetchDisasterAlerts() {
            try {
                const response = await fetch('https://api.example.com/disaster-alerts');
                const data = await response.json();
                displayAlerts(data);
            } catch (error) {
                console.error('災害情報の取得に失敗しました:', error);
            }
        }

        function displayAlerts(alerts) {
            const container = document.getElementById('disasterInfo');
            container.innerHTML = alerts.map(alert => `
                <div class="disaster-alert">
                    <h4>${alert.title}</h4>
                    <p>${alert.description}</p>
                    <small>${new Date(alert.date).toLocaleString()}</small>
                </div>
            `).join('');
        }

        // 初期化処理
        fetchDisasterAlerts();
        L.control.locate().addTo(map);
    </script>
</body>
</html>
